<style>
    body {margin:0; }
    #container { background:#fff; width:100%; height:auto; overflow:hidden; border:1px solid #E6E6E6; padding-bottom:15px; margin:0 auto; }
    .banner { background:#8dc9e8; width:75%;height:126px; margin:15px 0 0 0; padding-bottom:20px; border-radius:10px 10px 0px 0px;  -webkit-border-radius:10px 10px 0px 0px;overflow: hidden;
        background: -moz-linear-gradient(top, #0094d5 0%, #1b5992 100%); /* firefox */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#0094d5), color-stop(100%,#1b5992)); /* webkit */}
    .banner-title {float:left; width:45%;height:106px;  font:bold 18px arial,helvetica,sans-serif;text-align:left; color:#fff; padding:0px 10px 10px 10px; }
    .edutorlogo {float:right; width:150px; height:35px; margin:10px; }
    .profile {background:#101010 ; width:73%; height:35px; padding-left:35px; font:normal 1.1em/1.5em arial,helvetica,sans-serif; line-height:35px; text-align:left; color:#FFFFFF;
        background: -moz-linear-gradient(top, #8dc9e8 0%, #0076c9 100%); /* firefox */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#8dc9e8), color-stop(100%,#0076c9)); /* webkit */}
    #merits { background:#1b5992; width:75%;height:45px;border-radius: 0px 0px 10px 10px;}
    #content { background:#fff; width:75%; height:auto; overflow:hidden; margin-bottom:3px;}
    #profileinfo {background:#fff; width:75%; height:90px; font:bold 14px arial,helvetica,sans-serif; line-height:30px; color:#000; margin-bottom:8px;}
    .odd{ height:30px; background: #c7d9e9;}
    .even{ height:30px; background: #e1ebf4;}
    .right{ float:right; width:73%; font: bold 14px/1.5em arial,helvetica,sans-serif; color:#000000; line-height:30px ;text-align: left; padding-left:10px;}
    .left{ float:left; width:25%; font: bold 14px/1.5em arial,helvetica,sans-serif; color:#000; line-height:30px; text-align: right; padding-right:10px;}
    .logo {float:left; width:225px; height:106px; margin:20px 0px 10px 10px; }
    #merits .left{background:#6f90b8; float:left; width:18%; height:35px; font: bold 16px arial,helvetica,sans-serif; color:#fff; line-height:35px; text-align: center; border-radius: 50px 0px 0px 50px; margin:5px 5px 0 22% ;}
    #merits .middle{background:#6f90b8; float:left; width:18%; height:35px; font: bold 16px arial,helvetica,sans-serif; color:#fff; line-height:35px; text-align: center;  margin:5px 5px 0 0;}
    #merits .right{ background:#6f90b8 ;float:left; width:18%; height:35px;font: bold 16px arial,helvetica,sans-serif; color:#fff; line-height:35px;text-align: center; border-radius:0px 50px 50px 0px; margin-top:5px;}

    table.listing {
        background: none repeat scroll 0 0 #5B88B1;
    }
    table.listing {
        padding: 3px;
    }
    tr.tr-head {
        background: none repeat scroll 0 0 #FFFFFF;
        color: #1B5A92;
    }
    tr.tr-head {
        font-weight: normal;
        text-align: left;
    }
    table.listing .tr-head th {
        cursor: pointer;
        font-family: HelveticaNeueLTStd55Roman,Arial,sans-serif;
        font-size: 12px;
        padding: 5px 20px 4px 10px;
        text-align: left;
    }
    table.listing .tr-even {
        font-size: 12px;
        font-weight: normal;
        padding: 50px;
        text-align: left;
    }
    tr.even {
        background-color: white;
    }
    table.listing .tr-odd {
        font-size: 12px;
        font-weight: normal;
        padding: 50px;
        text-align: left;
    }
    tr.odd {
        background-color: #E1EBF4;
    }
    table.listing td.col {
        padding: 3px 2px 3px 10px;
        text-align: left;
    }

    h1, h2, h3 {
        color: #1B5A92;
    }
    h1, h2, h3 {
        font-family: HelveticaNeueLTStd55Roman,arial,sans-serif;
        font-weight: normal;
    }
    h1 {
        font-size: 22px;
        margin: 15px 0;
    }
    .hr, .form .hr {
        color: #1B5A92;
    }
    .hr {
        border-bottom: 1px solid;
        margin-bottom: 10px;
        padding: 10px;
    }
</style>

<div align="center"> <!-- container starts-->
    <div class="banner">
        <div class="logo">
            <%= wicked_pdf_paperclip_image_tag @user.institution.profile.photo(:large) %>
        </div>
        <div class="edutorlogo">
            <%= wicked_pdf_paperclip_image_tag "/assets/images/edutor_logo.png" ,:alt=>"Edutor" %>
        </div>
        <div class="banner-title">
            <span>Assessment Report</span><br>
        </div>
    </div><!-- banner ends-->
    <div class="profile"><span>Student Profile</span></div>
    <div id="profileinfo">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td><table width="100%" height="95" border="0" cellpadding="0" cellspacing="0">
                    <tr>
                        <td width="185" bgcolor="#e1ebf4">&nbsp;&nbsp;Student Name:</td>
                        <td width="3" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="130" bgcolor="#e1ebf4">&nbsp;&nbsp;<%=@user.name%></td>
                        <td width="5" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="185" bgcolor="#e1ebf4">&nbsp;&nbsp;Edutor Id:</td>
                        <td width="3" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="120" bgcolor="#e1ebf4">&nbsp;&nbsp;<%=@user.edutorid%></td>
                    </tr>
                    <tr>
                        <td width="155" bgcolor="c7d9e9">&nbsp;&nbsp;Class:</td>
                        <td width="3" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="120" bgcolor="c7d9e9">&nbsp;&nbsp;<%=@user.academic_class.try(:name)%></td>
                        <td width="5" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="185" bgcolor="c7d9e9">&nbsp;&nbsp;School Id:</td>
                        <td width="3" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="120" bgcolor="c7d9e9">&nbsp;&nbsp;<%=@user.institution.school_uid%></td>
                    </tr>
                    <tr>
                        <td width="185" bgcolor="e1ebf4">&nbsp;&nbsp;Section:</td>
                        <td width="3" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="120" bgcolor="e1ebf4">&nbsp;&nbsp;<%=@user.section.try(:name)%></td>
                        <td width="5" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="185" bgcolor="e1ebf4">&nbsp;&nbsp;</td>
                        <td width="3" bgcolor="#FFFFFF">&nbsp;</td>
                        <td width="120" bgcolor="e1ebf4">&nbsp;</td>
                    </tr>
                </table></td>
            </tr>
        </table>
    </div>
    <div class="profile"><span>Assesment Details</span></div>
    <div id="content">
        <div class="odd left">Assessment Name</div> <div class="odd right"><%= @quiz.name%></div>
        <div class="even left">Assessment attempted date</div> <div class="even right"><%= display_date_time(@quiz_attempt.first.timefinish)%></div>
        <div class="odd left">Subject</div> <div class="odd right"><%= @quiz.context.subject.try(:name)%></div>
        <div class="even left">Duration of test(minutes)</div> <div class="even right"><%= @quiz.timelimit%></div>
        <div class="odd left">Number of total questions</div> <div class="odd right"><%= @quiz.questions.count%></div>
        <div class="even left">Number of correct attempts</div> <div class="even right"><span style="color:green;"><%= @question_attempts.where(:correct=>true).count%></span>/<%= @quiz.questions.count%></div>
        <div class="odd left">Number of wrong attempts</div> <div class="odd right"><span style="color:#ff0000;"><%= @question_attempts.where(:correct=>false).count%></span>/<%= @quiz.questions.count%></div>
     <!--   <div class="even left">Number of unattempted questions</div> <div class="even right"><%= McqQuestionAttempt.where(:quiz_question_attempt_id =>@question_attempts.map(&:id),:question_answer_id=>0).count %>/<%= @quiz.questions.count%></div> -->
    </div>
    <div id="merits">
        <div class="left">Score: <%=@question_attempts.sum(:marks).round(1)%>/<%= @quiz.questions.sum(:defaultmark).to_i%></div>
        <div class="middle">Class Average: <%=@total_average.round(1) %></div>
        <div class="right">Toppper Score: <%=@top_score.round(1) %></div>
    </div>
    <div class='label heading hr'>
        <div>
            <h1>Attempt Details</h1>
        </div>
    </div>
    <div>
        <table width='86%'>
            <tr>
                <td id='publish_list' valign='top'>
                    <table cellpadding='1' cellspacing='1'>
                        <table align='center' cellpadding='1' cellspacing='1' class='listing sort_table' id='publish_groups' width='100%'>
                            <thead>
                            <tr class='tr-head'>
                                <th></th>
                                <%if @quiz.format_type == 0 %>
                                <th>Question</th>
                                <%end%>
                                <th>Attempt</th>
                                <th>Option selected</th>
                                <th>Correct answer(s)</th>
                                <th>Marks</th>
                                <%if @quiz.format_type == 0 %>
                                <th>Time taken (seconds)</th>
                                <%end%>
                                <th>Correct percentage in class</th>

                            </tr>
                            </thead>
                            <tbody>
                            <%i=0%>
                            <% n = 1 %>
                            <% @question_attempts.each do |t| %>
                            <%if @quiz.format_type == 0 %>
                            <% if i%2 == 0 %>
                                <tr class="tr-even even">
                            <% else %>
                                <tr class="tr-odd odd">
                            <% end %>
                                <td class="col">
                                 <%=n %>
                                </td>
                                <% question = Question.includes(:question_fill_blanks).find(t.question_id)%>
                                <td class="col"><%= question.pdf_questiontext_format.gsub("<p>","").gsub("</p>","").html_safe%></td>
                                <% if question.qtype == 'fib'%>
                                <% attempts = FibQuestionAttempt.where(:quiz_question_attempt_id=>t.id)%>
                                <%f_ans = []%>
                                <%question.question_fill_blanks.each do |q|
                                if q.case_sensitive
                                f_ans << q.answer.split(',').join(' or ')
                                else
                                f_ans << "#{q.answer.upcase.split(',').join(' or ')} (or) #{q.answer.downcase.split(',').join(' or ')}"
                                end
                                end
                                %>
                                <% if t.correct? %>
                                <td class="col"><%=wicked_pdf_paperclip_image_tag "/assets/web-app-theme/icons/tick.png" ,:alt=>"Correct"%></td>
                                <%elsif !attempts.first.selected %>
                                <td class="col">Not Attempted</td>
                                <%else%>
                                <td class="col"><%=wicked_pdf_paperclip_image_tag "/assets/web-app-theme/icons/cross.png" ,:alt=>"Wrong"%></td>
                                <%end%>
				                <td class="col"><%= JSON.load(JSON.load(attempts.first.fib_question_answer.to_json)).join(',') if attempts.first.selected rescue attempts.first.fib_question_answer  %></td>
        			            <td class="col"><%= f_ans.join(',') %></td>
                                <%else%>
                                <% attempts = McqQuestionAttempt.where(:quiz_question_attempt_id=>t.id)
                                ans = []
                                if attempts.size ==1 && attempts.first.question_answer_id ==0
                                ans << "Not Attempted"
                                else
                                attempts.each do |a|
                                qans = QuestionAnswer.find(a.question_answer_id).pdf_answer_format
                                ans << qans
                                end
                                end
                                %>
                                <% correct_answers = QuestionAnswer.where(:question=>t.question_id,:fraction=>1)
                                c_ans = []
                                correct_answers.each do |a|
                                c_ans << a.pdf_answer_format
                                end
                                %>
                                <% if t.correct? %>
                                <td class="col"><%=wicked_pdf_paperclip_image_tag "/assets/web-app-theme/icons/tick.png" ,:alt=>"Correct"%></td>
                                <%elsif ans.empty?%>
                                <td class="col">Not Attempted</td>
                                <%else%>
                                <td class="col"><%=wicked_pdf_paperclip_image_tag "/assets/web-app-theme/icons/cross.png" ,:alt=>"Wrong"%></td>
                                <%end%>

                                <td class="col"><%= ans.join(",").html_safe %></td>
                                <td class="col"><%= c_ans.join(",").html_safe %></td>
                                <%end%>
                                <td class="col"><%= t.marks%></td>
                                <td class="col"><%= (t.time_taken)%></td>
                                <td class="col"><%= question_attempt_average(@total_students,t.question_id).round(1)%></td>
                            </tr>
                            <%i = i+1%>
                            <% n = n+1 %>
                            <%  else %>
                            <% if i%2 == 0 %>
                            <tr class="tr-even even">
                                <% else %>
                            <tr class="tr-odd odd">
                                <% end %>
                                <td class="col"><%= Question.find(t.question_id).tag%></td>
                                <% attempts = McqQuestionAttempt.where(:quiz_question_attempt_id=>t.id)
                                ans = []
                                if attempts.size ==1 && attempts.first.question_answer_id ==0
                                ans << "Not Attempted"
                                else
                                attempts.each do |a|
                                qans = QuestionAnswer.find(a.question_answer_id).tag
                                ans << qans
                                end
                                end
                                %>
                                <% correct_answers = QuestionAnswer.where(:question=>t.question_id,:fraction=>1)
                                c_ans = []
                                correct_answers.each do |a|
                                c_ans << a.tag
                                end
                                %>
                                <% if t.correct? %>
                                <td class="col"><%=wicked_pdf_paperclip_image_tag "/assets/web-app-theme/icons/tick.png" ,:alt=>"Correct"%></td>
                                <%elsif ans.empty?%>
                                <td class="col">Not Attempted</td>
                                <%else%>
                                <td class="col"><%=wicked_pdf_paperclip_image_tag "/assets/web-app-theme/icons/cross.png" ,:alt=>"Wrong"%></td>
                                <%end%>

                                <td class="col"><%= ans.join(",").html_safe %></td>
                                <td class="col"><%= c_ans.join(",").html_safe %></td>
                                <td class="col"><%= t.marks%></td>
                                <td class="col"><%= question_attempt_average(@total_students,t.question_id).round(1)%></td>


                            </tr>
                            <%i = i+1%>
                            <%end%>
                            <%end%>
                            <% if i%2 == 0 %>
                            <tr class="tr-even even">
                                <% else %>
                            <tr class="tr-odd odd">
                                <% end %>
                                <td class="col"></td>
                                <td class="col"></td>
                                <td class="col"></td>
                                <td class="col"></td>
                                <td class="col">Total Marks = <%=@question_attempts.sum(:marks).round(1)%></td>
                                <td class="col"></td>
                            </tr>
                            </tbody>
                        </table>
                    </table>
                </td>
            </tr>
        </table>
    </div>
</div> <!-- container ends-->
